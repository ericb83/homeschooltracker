<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale1.0" />
    <title>Homeschool Tracker</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Freeman&display=swap"
      rel="stylesheet"
    />

    <link rel="stylesheet" href="styles.css" />
    <!-- Include CryptoJS library -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>

    <script>
      function generateParentId() {
      // Create a random ID using the current timestamp and a random number
      return 'parent-' + Date.now() + '-' + Math.floor(Math.random() * 10000);
    }

      async function showAlert(event){
        event.preventDefault(); //Prevent form submission
        const name = document.getElementById('name').value;
        const phoneNumber = document.getElementById('phone_number').value;
        const email = document.getElementById('email').value;
        const password = document.getElementById('password').value;

        if (name && phoneNumber && email && password) {

           // Hash the password using CryptoJS
        const hashedPassword = CryptoJS.SHA256(password).toString();
         // Generate a random parent ID
         const parentId = generateParentId();


          //send data to server
          const response = await fetch('/signup', {
            method: 'POST', 
            headers: {
              'Content-Type': 'application/json'
            },
            body: JSON.stringify({
              parent_id: parentId,
              name: name,
              phone_number: phoneNumber,
              email: email,
              password: hashedPassword
            })

          });

          if (response.ok){
            alert('Signup successful');
            // Redirect to login page
          window.location.href = '/login';
          } else {
            alert('Signup failed. Please try again.');
          }
        } else {
          alert('Please fill out all fields')
        }
      }
    </script>
  </head>
  <body>
    <!-- Header -->
    <h1>Homeschool Tracker</h1>

    <h2>Signup</h2>

    <!--Signup Form -->
    <form onsubmit="showAlert()" class="grid-container">
      <div class="form-item">
        <label for="name">Name:</label>
        <input type="text" id="name" name="name" required />
      </div>

      <div class="form-item">
        <label for="phone_number">Phone Number:</label>
        <input type="tel" id="phone_number" name="phone_number" required />
      </div>

      <div class="form-item">
        <label for="email">Email:</label>
        <input type="email" id="email" name="email" required />
      </div>

      <div class="form-item">
        <label for="password">Password:</label>
        <input type="password" id="password" name="password" required />
      </div>

      <input type="submit" value="Signup" class="custom-button" />
    </form>
  </body>
</html>
